0001   0000             ;
0002   0000             ; Original Code and hardware by Frank Palazzolo
0003   0000             ; Code written and working sometime in the early 2000's
0004   0000             ; Source Reverse-engineered from Binary(!)
0005   0000             ; And updated for standard SPI master interface - 2022-October
0006   0000             ; Added Chip ID functions, 2022-November
0007   0000             ;
0008   0000             ; This code can be built with TASM Version 3.2:
0009   0000             ;   tasm -70 -g3 -fff -s -c dumper.asm dumper.bin
0010   0000             ;
0011   0000             ; Dumper code for PIC70XX, TMS70XX, TMS70XXX, TMS77XX, TMS70CXX, and TMS77CXX chips
0012   0000             ;
0013   0000             ; Hardware connections:
0014   0000             ;
0015   0000             ; ~INT1 and ~INT3 wired to +5 - pins 13 and 12 on DIP
0016   0000             ; Port B, bit 0 - Pin 3 on DIP  - MC Pin is connected here, along with a 4.7k pullup 
0017   0000             ; Port B, bit 1 - Pin 4 on DIP  - MOSI - Bits appear here
0018   0000             ; Port B, bit 2 - Pin 5 on DIP  - SCLK - Rising Edge happens during bit
0019   0000             ; Port B, bit 3 - Pin 37 on DIP - ~SS
0020   0000             ;
0021   0000             ; When External Memory is enabled:
0022   0000             ;
0023   0000             ; Port B, bit 4 - Pin 38 on DIP - ALATCH
0024   0000             ; Port B, bit 5 - Pin 1 on DIP  - R/~W 
0025   0000             ; Port B, bit 6 - Pin 39 on DIP - ~ENABLE
0026   0000             ; Port B, bit 7 - Pin 2 on DIP  - CLKOUT 
0027   0000             ; Port C, all   - Address Low / Data Bus
0028   0000             ; Port D, all   - Address High Bus
0029   0000             
0030   0000             ; Chip starts up in Microprocessor mode, executing ROM from external memory
0031   0000             ; 1) Code checks ram size and for presence of serial port, to generate initial ID byte
0032   0000             ; 2) Trojan Code segment is copied from external ROM to internal RAM
0033   0000             ; 3) Jump to code in internal RAM 
0034   0000             ; 4) Switch modes, enabling internal ROM 
0035   0000             ; 5) Code determines internal ROM size and adjusts ID byte
0036   0000             ; 6) Code clocks out bytes via SPI:
0037   0000             ;    ID byte, followed by 0K, 2K, or 4K bytes
0038   0000             
0039   0000             ; RAM Layout
0040   0000             ; 0x00-0x07 - A,B,R2-R7 Used as general purpose storage
0041   0000             ; 0x08-0x7C - Used for Trojan program
0042   0000             ; 0x7D-0x7E - Spare
0043   0000             ; 0x7F      - used to determine RAM size
0044   0000             
0045   0000             ; ID Byte -
0046   0000             ;     0x00 - 0b00000000 - 128 bytes of ram, 0K ROM
0047   0000             ;     0x01 - 0b00000001 - 128 bytes of ram, serial port, 0K ROM
0048   0000             ;     0x02 - 0b00000010 - 256 bytes of ram, 0K ROM
0049   0000             ;     0x03 - 0b00000011 - 256 bytes of ram, serial port, 0K ROM
0050   0000             ;     0x04 - 0b00000100 - 128 bytes of ram, 2K ROM
0051   0000             ;     0x05 - 0b00000101 - 128 bytes of ram, serial port, 2K ROM
0052   0000             ;     0x06 - 0b00000110 - 256 bytes of ram, 0K ROM
0053   0000             ;     0x07 - 0b00000111 - 256 bytes of ram, serial port, 2K ROM
0054   0000             ;     0x08 - 0b00001000 - 128 bytes of ram, 4K ROM
0055   0000             ;     0x09 - 0b00001001 - 128 bytes of ram, serial port, 4K ROM
0056   0000             ;     0x0a - 0b00001010 - 256 bytes of ram, 4K ROM
0057   0000             ;     0x0b - 0b00001011 - 256 bytes of ram, serial port, 4K ROM
0058   0000             ;     0x10 - 0b00010000 - 128 bytes of ram, >4K ROM
0059   0000             ;     0x11 - 0b00010001 - 128 bytes of ram, serial port, >4K ROM
0060   0000             ;     0x12 - 0b00010010 - 256 bytes of ram, >4K ROM
0061   0000             ;     0x13 - 0b00010011 - 256 bytes of ram, serial port, >4K ROM
0062   0000             ;     Any other values are errors
0063   0000             
0064   0000             ;R0      .equ    0   ; AKA A Register
0065   0000             ;R1      .equ    1   ; AKA B Register
0066   0000             R2      .equ    2
0067   0000             R3      .equ    3
0068   0000             R4      .equ    4
0069   0000             R5      .equ    5
0070   0000             R6      .equ    6
0071   0000             R7      .equ    7
0072   0000             
0073   0000             ; peripherals
0074   0000             
0075   0000             IOCNT0  .equ    0   ; Used to control modes via the CPU
0076   0000             ;BPORT   .equ    6   ; Used to switch modes via external connection, and used for SPI interface
0077   0000             ARDADDR .equ    $1000 ; used to write to the Arduino
0078   0000             SCTL1   .equ    21  ; Used to probe for a Serial Port on the 70x2
0079   0000             SCTL1C  .equ    24  ; Used to probe for a Serial Port on the 70Cx2
0080   0000             
0081   0000             RAMDEST .equ    $0008       ; location in ram for the code to be copied into and run from
0082   0000             
0083   0000                     .ORG    $0000       ; nothing here
0084   0000 00 00 00 00         .FILL   $1000,$00
0084   0004 00 00 00 00 
0084   0008 00 00 00 00 
0084   000C 00 00 00 00 
0084   0010 00 00 00 00 
0084   0014 00 00 00 00 
0084   0018 00 00 00 00 
0084   001C 00 00 00 00 
0084   0020 00 00 00 00 
0084   0024 00 00 00 00 
0084   0028 00 00 00 00 
0084   002C 00 00 00 00 
0084   0030 00 00 00 00 
0084   0034 00 00 00 00 
0084   0038 00 00 00 00 
0084   003C 00 00 00 00 
0084   0040 00 00 00 00 
0084   0044 00 00 00 00 
0084   0048 00 00 00 00 
0084   004C 00 00 00 00 
0084   0050 00 00 00 00 
0084   0054 00 00 00 00 
0084   0058 00 00 00 00 
0084   005C 00 00 00 00 
0084   0060 00 00 00 00 
0084   0064 00 00 00 00 
0084   0068 00 00 00 00 
0084   006C 00 00 00 00 
0084   0070 00 00 00 00 
0084   0074 00 00 00 00 
0084   0078 00 00 00 00 
0084   007C 00 00 00 00 
0084   0080 00 00 00 00 
0084   0084 00 00 00 00 
0084   0088 00 00 00 00 
0084   008C 00 00 00 00 
0084   0090 00 00 00 00 
0084   0094 00 00 00 00 
0084   0098 00 00 00 00 
0084   009C 00 00 00 00 
0084   00A0 00 00 00 00 
0084   00A4 00 00 00 00 
0084   00A8 00 00 00 00 
0084   00AC 00 00 00 00 
0084   00B0 00 00 00 00 
0084   00B4 00 00 00 00 
0084   00B8 00 00 00 00 
0084   00BC 00 00 00 00 
0084   00C0 00 00 00 00 
0084   00C4 00 00 00 00 
0084   00C8 00 00 00 00 
0084   00CC 00 00 00 00 
0084   00D0 00 00 00 00 
0084   00D4 00 00 00 00 
0084   00D8 00 00 00 00 
0084   00DC 00 00 00 00 
0084   00E0 00 00 00 00 
0084   00E4 00 00 00 00 
0084   00E8 00 00 00 00 
0084   00EC 00 00 00 00 
0084   00F0 00 00 00 00 
0084   00F4 00 00 00 00 
0084   00F8 00 00 00 00 
0084   00FC 00 00 00 00 
0084   0100 00 00 00 00 
0084   0104 00 00 00 00 
0084   0108 00 00 00 00 
0084   010C 00 00 00 00 
0084   0110 00 00 00 00 
0084   0114 00 00 00 00 
0084   0118 00 00 00 00 
0084   011C 00 00 00 00 
0084   0120 00 00 00 00 
0084   0124 00 00 00 00 
0084   0128 00 00 00 00 
0084   012C 00 00 00 00 
0084   0130 00 00 00 00 
0084   0134 00 00 00 00 
0084   0138 00 00 00 00 
0084   013C 00 00 00 00 
0084   0140 00 00 00 00 
0084   0144 00 00 00 00 
0084   0148 00 00 00 00 
0084   014C 00 00 00 00 
0084   0150 00 00 00 00 
0084   0154 00 00 00 00 
0084   0158 00 00 00 00 
0084   015C 00 00 00 00 
0084   0160 00 00 00 00 
0084   0164 00 00 00 00 
0084   0168 00 00 00 00 
0084   016C 00 00 00 00 
0084   0170 00 00 00 00 
0084   0174 00 00 00 00 
0084   0178 00 00 00 00 
0084   017C 00 00 00 00 
0084   0180 00 00 00 00 
0084   0184 00 00 00 00 
0084   0188 00 00 00 00 
0084   018C 00 00 00 00 
0084   0190 00 00 00 00 
0084   0194 00 00 00 00 
0084   0198 00 00 00 00 
0084   019C 00 00 00 00 
0084   01A0 00 00 00 00 
0084   01A4 00 00 00 00 
0084   01A8 00 00 00 00 
0084   01AC 00 00 00 00 
0084   01B0 00 00 00 00 
0084   01B4 00 00 00 00 
0084   01B8 00 00 00 00 
0084   01BC 00 00 00 00 
0084   01C0 00 00 00 00 
0084   01C4 00 00 00 00 
0084   01C8 00 00 00 00 
0084   01CC 00 00 00 00 
0084   01D0 00 00 00 00 
0084   01D4 00 00 00 00 
0084   01D8 00 00 00 00 
0084   01DC 00 00 00 00 
0084   01E0 00 00 00 00 
0084   01E4 00 00 00 00 
0084   01E8 00 00 00 00 
0084   01EC 00 00 00 00 
0084   01F0 00 00 00 00 
0084   01F4 00 00 00 00 
0084   01F8 00 00 00 00 
0084   01FC 00 00 00 00 
0084   0200 00 00 00 00 
0084   0204 00 00 00 00 
0084   0208 00 00 00 00 
0084   020C 00 00 00 00 
0084   0210 00 00 00 00 
0084   0214 00 00 00 00 
0084   0218 00 00 00 00 
0084   021C 00 00 00 00 
0084   0220 00 00 00 00 
0084   0224 00 00 00 00 
0084   0228 00 00 00 00 
0084   022C 00 00 00 00 
0084   0230 00 00 00 00 
0084   0234 00 00 00 00 
0084   0238 00 00 00 00 
0084   023C 00 00 00 00 
0084   0240 00 00 00 00 
0084   0244 00 00 00 00 
0084   0248 00 00 00 00 
0084   024C 00 00 00 00 
0084   0250 00 00 00 00 
0084   0254 00 00 00 00 
0084   0258 00 00 00 00 
0084   025C 00 00 00 00 
0084   0260 00 00 00 00 
0084   0264 00 00 00 00 
0084   0268 00 00 00 00 
0084   026C 00 00 00 00 
0084   0270 00 00 00 00 
0084   0274 00 00 00 00 
0084   0278 00 00 00 00 
0084   027C 00 00 00 00 
0084   0280 00 00 00 00 
0084   0284 00 00 00 00 
0084   0288 00 00 00 00 
0084   028C 00 00 00 00 
0084   0290 00 00 00 00 
0084   0294 00 00 00 00 
0084   0298 00 00 00 00 
0084   029C 00 00 00 00 
0084   02A0 00 00 00 00 
0084   02A4 00 00 00 00 
0084   02A8 00 00 00 00 
0084   02AC 00 00 00 00 
0084   02B0 00 00 00 00 
0084   02B4 00 00 00 00 
0084   02B8 00 00 00 00 
0084   02BC 00 00 00 00 
0084   02C0 00 00 00 00 
0084   02C4 00 00 00 00 
0084   02C8 00 00 00 00 
0084   02CC 00 00 00 00 
0084   02D0 00 00 00 00 
0084   02D4 00 00 00 00 
0084   02D8 00 00 00 00 
0084   02DC 00 00 00 00 
0084   02E0 00 00 00 00 
0084   02E4 00 00 00 00 
0084   02E8 00 00 00 00 
0084   02EC 00 00 00 00 
0084   02F0 00 00 00 00 
0084   02F4 00 00 00 00 
0084   02F8 00 00 00 00 
0084   02FC 00 00 00 00 
0084   0300 00 00 00 00 
0084   0304 00 00 00 00 
0084   0308 00 00 00 00 
0084   030C 00 00 00 00 
0084   0310 00 00 00 00 
0084   0314 00 00 00 00 
0084   0318 00 00 00 00 
0084   031C 00 00 00 00 
0084   0320 00 00 00 00 
0084   0324 00 00 00 00 
0084   0328 00 00 00 00 
0084   032C 00 00 00 00 
0084   0330 00 00 00 00 
0084   0334 00 00 00 00 
0084   0338 00 00 00 00 
0084   033C 00 00 00 00 
0084   0340 00 00 00 00 
0084   0344 00 00 00 00 
0084   0348 00 00 00 00 
0084   034C 00 00 00 00 
0084   0350 00 00 00 00 
0084   0354 00 00 00 00 
0084   0358 00 00 00 00 
0084   035C 00 00 00 00 
0084   0360 00 00 00 00 
0084   0364 00 00 00 00 
0084   0368 00 00 00 00 
0084   036C 00 00 00 00 
0084   0370 00 00 00 00 
0084   0374 00 00 00 00 
0084   0378 00 00 00 00 
0084   037C 00 00 00 00 
0084   0380 00 00 00 00 
0084   0384 00 00 00 00 
0084   0388 00 00 00 00 
0084   038C 00 00 00 00 
0084   0390 00 00 00 00 
0084   0394 00 00 00 00 
0084   0398 00 00 00 00 
0084   039C 00 00 00 00 
0084   03A0 00 00 00 00 
0084   03A4 00 00 00 00 
0084   03A8 00 00 00 00 
0084   03AC 00 00 00 00 
0084   03B0 00 00 00 00 
0084   03B4 00 00 00 00 
0084   03B8 00 00 00 00 
0084   03BC 00 00 00 00 
0084   03C0 00 00 00 00 
0084   03C4 00 00 00 00 
0084   03C8 00 00 00 00 
0084   03CC 00 00 00 00 
0084   03D0 00 00 00 00 
0084   03D4 00 00 00 00 
0084   03D8 00 00 00 00 
0084   03DC 00 00 00 00 
0084   03E0 00 00 00 00 
0084   03E4 00 00 00 00 
0084   03E8 00 00 00 00 
0084   03EC 00 00 00 00 
0084   03F0 00 00 00 00 
0084   03F4 00 00 00 00 
0084   03F8 00 00 00 00 
0084   03FC 00 00 00 00 
0084   0400 00 00 00 00 
0084   0404 00 00 00 00 
0084   0408 00 00 00 00 
0084   040C 00 00 00 00 
0084   0410 00 00 00 00 
0084   0414 00 00 00 00 
0084   0418 00 00 00 00 
0084   041C 00 00 00 00 
0084   0420 00 00 00 00 
0084   0424 00 00 00 00 
0084   0428 00 00 00 00 
0084   042C 00 00 00 00 
0084   0430 00 00 00 00 
0084   0434 00 00 00 00 
0084   0438 00 00 00 00 
0084   043C 00 00 00 00 
0084   0440 00 00 00 00 
0084   0444 00 00 00 00 
0084   0448 00 00 00 00 
0084   044C 00 00 00 00 
0084   0450 00 00 00 00 
0084   0454 00 00 00 00 
0084   0458 00 00 00 00 
0084   045C 00 00 00 00 
0084   0460 00 00 00 00 
0084   0464 00 00 00 00 
0084   0468 00 00 00 00 
0084   046C 00 00 00 00 
0084   0470 00 00 00 00 
0084   0474 00 00 00 00 
0084   0478 00 00 00 00 
0084   047C 00 00 00 00 
0084   0480 00 00 00 00 
0084   0484 00 00 00 00 
0084   0488 00 00 00 00 
0084   048C 00 00 00 00 
0084   0490 00 00 00 00 
0084   0494 00 00 00 00 
0084   0498 00 00 00 00 
0084   049C 00 00 00 00 
0084   04A0 00 00 00 00 
0084   04A4 00 00 00 00 
0084   04A8 00 00 00 00 
0084   04AC 00 00 00 00 
0084   04B0 00 00 00 00 
0084   04B4 00 00 00 00 
0084   04B8 00 00 00 00 
0084   04BC 00 00 00 00 
0084   04C0 00 00 00 00 
0084   04C4 00 00 00 00 
0084   04C8 00 00 00 00 
0084   04CC 00 00 00 00 
0084   04D0 00 00 00 00 
0084   04D4 00 00 00 00 
0084   04D8 00 00 00 00 
0084   04DC 00 00 00 00 
0084   04E0 00 00 00 00 
0084   04E4 00 00 00 00 
0084   04E8 00 00 00 00 
0084   04EC 00 00 00 00 
0084   04F0 00 00 00 00 
0084   04F4 00 00 00 00 
0084   04F8 00 00 00 00 
0084   04FC 00 00 00 00 
0084   0500 00 00 00 00 
0084   0504 00 00 00 00 
0084   0508 00 00 00 00 
0084   050C 00 00 00 00 
0084   0510 00 00 00 00 
0084   0514 00 00 00 00 
0084   0518 00 00 00 00 
0084   051C 00 00 00 00 
0084   0520 00 00 00 00 
0084   0524 00 00 00 00 
0084   0528 00 00 00 00 
0084   052C 00 00 00 00 
0084   0530 00 00 00 00 
0084   0534 00 00 00 00 
0084   0538 00 00 00 00 
0084   053C 00 00 00 00 
0084   0540 00 00 00 00 
0084   0544 00 00 00 00 
0084   0548 00 00 00 00 
0084   054C 00 00 00 00 
0084   0550 00 00 00 00 
0084   0554 00 00 00 00 
0084   0558 00 00 00 00 
0084   055C 00 00 00 00 
0084   0560 00 00 00 00 
0084   0564 00 00 00 00 
0084   0568 00 00 00 00 
0084   056C 00 00 00 00 
0084   0570 00 00 00 00 
0084   0574 00 00 00 00 
0084   0578 00 00 00 00 
0084   057C 00 00 00 00 
0084   0580 00 00 00 00 
0084   0584 00 00 00 00 
0084   0588 00 00 00 00 
0084   058C 00 00 00 00 
0084   0590 00 00 00 00 
0084   0594 00 00 00 00 
0084   0598 00 00 00 00 
0084   059C 00 00 00 00 
0084   05A0 00 00 00 00 
0084   05A4 00 00 00 00 
0084   05A8 00 00 00 00 
0084   05AC 00 00 00 00 
0084   05B0 00 00 00 00 
0084   05B4 00 00 00 00 
0084   05B8 00 00 00 00 
0084   05BC 00 00 00 00 
0084   05C0 00 00 00 00 
0084   05C4 00 00 00 00 
0084   05C8 00 00 00 00 
0084   05CC 00 00 00 00 
0084   05D0 00 00 00 00 
0084   05D4 00 00 00 00 
0084   05D8 00 00 00 00 
0084   05DC 00 00 00 00 
0084   05E0 00 00 00 00 
0084   05E4 00 00 00 00 
0084   05E8 00 00 00 00 
0084   05EC 00 00 00 00 
0084   05F0 00 00 00 00 
0084   05F4 00 00 00 00 
0084   05F8 00 00 00 00 
0084   05FC 00 00 00 00 
0084   0600 00 00 00 00 
0084   0604 00 00 00 00 
0084   0608 00 00 00 00 
0084   060C 00 00 00 00 
0084   0610 00 00 00 00 
0084   0614 00 00 00 00 
0084   0618 00 00 00 00 
0084   061C 00 00 00 00 
0084   0620 00 00 00 00 
0084   0624 00 00 00 00 
0084   0628 00 00 00 00 
0084   062C 00 00 00 00 
0084   0630 00 00 00 00 
0084   0634 00 00 00 00 
0084   0638 00 00 00 00 
0084   063C 00 00 00 00 
0084   0640 00 00 00 00 
0084   0644 00 00 00 00 
0084   0648 00 00 00 00 
0084   064C 00 00 00 00 
0084   0650 00 00 00 00 
0084   0654 00 00 00 00 
0084   0658 00 00 00 00 
0084   065C 00 00 00 00 
0084   0660 00 00 00 00 
0084   0664 00 00 00 00 
0084   0668 00 00 00 00 
0084   066C 00 00 00 00 
0084   0670 00 00 00 00 
0084   0674 00 00 00 00 
0084   0678 00 00 00 00 
0084   067C 00 00 00 00 
0084   0680 00 00 00 00 
0084   0684 00 00 00 00 
0084   0688 00 00 00 00 
0084   068C 00 00 00 00 
0084   0690 00 00 00 00 
0084   0694 00 00 00 00 
0084   0698 00 00 00 00 
0084   069C 00 00 00 00 
0084   06A0 00 00 00 00 
0084   06A4 00 00 00 00 
0084   06A8 00 00 00 00 
0084   06AC 00 00 00 00 
0084   06B0 00 00 00 00 
0084   06B4 00 00 00 00 
0084   06B8 00 00 00 00 
0084   06BC 00 00 00 00 
0084   06C0 00 00 00 00 
0084   06C4 00 00 00 00 
0084   06C8 00 00 00 00 
0084   06CC 00 00 00 00 
0084   06D0 00 00 00 00 
0084   06D4 00 00 00 00 
0084   06D8 00 00 00 00 
0084   06DC 00 00 00 00 
0084   06E0 00 00 00 00 
0084   06E4 00 00 00 00 
0084   06E8 00 00 00 00 
0084   06EC 00 00 00 00 
0084   06F0 00 00 00 00 
0084   06F4 00 00 00 00 
0084   06F8 00 00 00 00 
0084   06FC 00 00 00 00 
0084   0700 00 00 00 00 
0084   0704 00 00 00 00 
0084   0708 00 00 00 00 
0084   070C 00 00 00 00 
0084   0710 00 00 00 00 
0084   0714 00 00 00 00 
0084   0718 00 00 00 00 
0084   071C 00 00 00 00 
0084   0720 00 00 00 00 
0084   0724 00 00 00 00 
0084   0728 00 00 00 00 
0084   072C 00 00 00 00 
0084   0730 00 00 00 00 
0084   0734 00 00 00 00 
0084   0738 00 00 00 00 
0084   073C 00 00 00 00 
0084   0740 00 00 00 00 
0084   0744 00 00 00 00 
0084   0748 00 00 00 00 
0084   074C 00 00 00 00 
0084   0750 00 00 00 00 
0084   0754 00 00 00 00 
0084   0758 00 00 00 00 
0084   075C 00 00 00 00 
0084   0760 00 00 00 00 
0084   0764 00 00 00 00 
0084   0768 00 00 00 00 
0084   076C 00 00 00 00 
0084   0770 00 00 00 00 
0084   0774 00 00 00 00 
0084   0778 00 00 00 00 
0084   077C 00 00 00 00 
0084   0780 00 00 00 00 
0084   0784 00 00 00 00 
0084   0788 00 00 00 00 
0084   078C 00 00 00 00 
0084   0790 00 00 00 00 
0084   0794 00 00 00 00 
0084   0798 00 00 00 00 
0084   079C 00 00 00 00 
0084   07A0 00 00 00 00 
0084   07A4 00 00 00 00 
0084   07A8 00 00 00 00 
0084   07AC 00 00 00 00 
0084   07B0 00 00 00 00 
0084   07B4 00 00 00 00 
0084   07B8 00 00 00 00 
0084   07BC 00 00 00 00 
0084   07C0 00 00 00 00 
0084   07C4 00 00 00 00 
0084   07C8 00 00 00 00 
0084   07CC 00 00 00 00 
0084   07D0 00 00 00 00 
0084   07D4 00 00 00 00 
0084   07D8 00 00 00 00 
0084   07DC 00 00 00 00 
0084   07E0 00 00 00 00 
0084   07E4 00 00 00 00 
0084   07E8 00 00 00 00 
0084   07EC 00 00 00 00 
0084   07F0 00 00 00 00 
0084   07F4 00 00 00 00 
0084   07F8 00 00 00 00 
0084   07FC 00 00 00 00 
0084   0800 00 00 00 00 
0084   0804 00 00 00 00 
0084   0808 00 00 00 00 
0084   080C 00 00 00 00 
0084   0810 00 00 00 00 
0084   0814 00 00 00 00 
0084   0818 00 00 00 00 
0084   081C 00 00 00 00 
0084   0820 00 00 00 00 
0084   0824 00 00 00 00 
0084   0828 00 00 00 00 
0084   082C 00 00 00 00 
0084   0830 00 00 00 00 
0084   0834 00 00 00 00 
0084   0838 00 00 00 00 
0084   083C 00 00 00 00 
0084   0840 00 00 00 00 
0084   0844 00 00 00 00 
0084   0848 00 00 00 00 
0084   084C 00 00 00 00 
0084   0850 00 00 00 00 
0084   0854 00 00 00 00 
0084   0858 00 00 00 00 
0084   085C 00 00 00 00 
0084   0860 00 00 00 00 
0084   0864 00 00 00 00 
0084   0868 00 00 00 00 
0084   086C 00 00 00 00 
0084   0870 00 00 00 00 
0084   0874 00 00 00 00 
0084   0878 00 00 00 00 
0084   087C 00 00 00 00 
0084   0880 00 00 00 00 
0084   0884 00 00 00 00 
0084   0888 00 00 00 00 
0084   088C 00 00 00 00 
0084   0890 00 00 00 00 
0084   0894 00 00 00 00 
0084   0898 00 00 00 00 
0084   089C 00 00 00 00 
0084   08A0 00 00 00 00 
0084   08A4 00 00 00 00 
0084   08A8 00 00 00 00 
0084   08AC 00 00 00 00 
0084   08B0 00 00 00 00 
0084   08B4 00 00 00 00 
0084   08B8 00 00 00 00 
0084   08BC 00 00 00 00 
0084   08C0 00 00 00 00 
0084   08C4 00 00 00 00 
0084   08C8 00 00 00 00 
0084   08CC 00 00 00 00 
0084   08D0 00 00 00 00 
0084   08D4 00 00 00 00 
0084   08D8 00 00 00 00 
0084   08DC 00 00 00 00 
0084   08E0 00 00 00 00 
0084   08E4 00 00 00 00 
0084   08E8 00 00 00 00 
0084   08EC 00 00 00 00 
0084   08F0 00 00 00 00 
0084   08F4 00 00 00 00 
0084   08F8 00 00 00 00 
0084   08FC 00 00 00 00 
0084   0900 00 00 00 00 
0084   0904 00 00 00 00 
0084   0908 00 00 00 00 
0084   090C 00 00 00 00 
0084   0910 00 00 00 00 
0084   0914 00 00 00 00 
0084   0918 00 00 00 00 
0084   091C 00 00 00 00 
0084   0920 00 00 00 00 
0084   0924 00 00 00 00 
0084   0928 00 00 00 00 
0084   092C 00 00 00 00 
0084   0930 00 00 00 00 
0084   0934 00 00 00 00 
0084   0938 00 00 00 00 
0084   093C 00 00 00 00 
0084   0940 00 00 00 00 
0084   0944 00 00 00 00 
0084   0948 00 00 00 00 
0084   094C 00 00 00 00 
0084   0950 00 00 00 00 
0084   0954 00 00 00 00 
0084   0958 00 00 00 00 
0084   095C 00 00 00 00 
0084   0960 00 00 00 00 
0084   0964 00 00 00 00 
0084   0968 00 00 00 00 
0084   096C 00 00 00 00 
0084   0970 00 00 00 00 
0084   0974 00 00 00 00 
0084   0978 00 00 00 00 
0084   097C 00 00 00 00 
0084   0980 00 00 00 00 
0084   0984 00 00 00 00 
0084   0988 00 00 00 00 
0084   098C 00 00 00 00 
0084   0990 00 00 00 00 
0084   0994 00 00 00 00 
0084   0998 00 00 00 00 
0084   099C 00 00 00 00 
0084   09A0 00 00 00 00 
0084   09A4 00 00 00 00 
0084   09A8 00 00 00 00 
0084   09AC 00 00 00 00 
0084   09B0 00 00 00 00 
0084   09B4 00 00 00 00 
0084   09B8 00 00 00 00 
0084   09BC 00 00 00 00 
0084   09C0 00 00 00 00 
0084   09C4 00 00 00 00 
0084   09C8 00 00 00 00 
0084   09CC 00 00 00 00 
0084   09D0 00 00 00 00 
0084   09D4 00 00 00 00 
0084   09D8 00 00 00 00 
0084   09DC 00 00 00 00 
0084   09E0 00 00 00 00 
0084   09E4 00 00 00 00 
0084   09E8 00 00 00 00 
0084   09EC 00 00 00 00 
0084   09F0 00 00 00 00 
0084   09F4 00 00 00 00 
0084   09F8 00 00 00 00 
0084   09FC 00 00 00 00 
0084   0A00 00 00 00 00 
0084   0A04 00 00 00 00 
0084   0A08 00 00 00 00 
0084   0A0C 00 00 00 00 
0084   0A10 00 00 00 00 
0084   0A14 00 00 00 00 
0084   0A18 00 00 00 00 
0084   0A1C 00 00 00 00 
0084   0A20 00 00 00 00 
0084   0A24 00 00 00 00 
0084   0A28 00 00 00 00 
0084   0A2C 00 00 00 00 
0084   0A30 00 00 00 00 
0084   0A34 00 00 00 00 
0084   0A38 00 00 00 00 
0084   0A3C 00 00 00 00 
0084   0A40 00 00 00 00 
0084   0A44 00 00 00 00 
0084   0A48 00 00 00 00 
0084   0A4C 00 00 00 00 
0084   0A50 00 00 00 00 
0084   0A54 00 00 00 00 
0084   0A58 00 00 00 00 
0084   0A5C 00 00 00 00 
0084   0A60 00 00 00 00 
0084   0A64 00 00 00 00 
0084   0A68 00 00 00 00 
0084   0A6C 00 00 00 00 
0084   0A70 00 00 00 00 
0084   0A74 00 00 00 00 
0084   0A78 00 00 00 00 
0084   0A7C 00 00 00 00 
0084   0A80 00 00 00 00 
0084   0A84 00 00 00 00 
0084   0A88 00 00 00 00 
0084   0A8C 00 00 00 00 
0084   0A90 00 00 00 00 
0084   0A94 00 00 00 00 
0084   0A98 00 00 00 00 
0084   0A9C 00 00 00 00 
0084   0AA0 00 00 00 00 
0084   0AA4 00 00 00 00 
0084   0AA8 00 00 00 00 
0084   0AAC 00 00 00 00 
0084   0AB0 00 00 00 00 
0084   0AB4 00 00 00 00 
0084   0AB8 00 00 00 00 
0084   0ABC 00 00 00 00 
0084   0AC0 00 00 00 00 
0084   0AC4 00 00 00 00 
0084   0AC8 00 00 00 00 
0084   0ACC 00 00 00 00 
0084   0AD0 00 00 00 00 
0084   0AD4 00 00 00 00 
0084   0AD8 00 00 00 00 
0084   0ADC 00 00 00 00 
0084   0AE0 00 00 00 00 
0084   0AE4 00 00 00 00 
0084   0AE8 00 00 00 00 
0084   0AEC 00 00 00 00 
0084   0AF0 00 00 00 00 
0084   0AF4 00 00 00 00 
0084   0AF8 00 00 00 00 
0084   0AFC 00 00 00 00 
0084   0B00 00 00 00 00 
0084   0B04 00 00 00 00 
0084   0B08 00 00 00 00 
0084   0B0C 00 00 00 00 
0084   0B10 00 00 00 00 
0084   0B14 00 00 00 00 
0084   0B18 00 00 00 00 
0084   0B1C 00 00 00 00 
0084   0B20 00 00 00 00 
0084   0B24 00 00 00 00 
0084   0B28 00 00 00 00 
0084   0B2C 00 00 00 00 
0084   0B30 00 00 00 00 
0084   0B34 00 00 00 00 
0084   0B38 00 00 00 00 
0084   0B3C 00 00 00 00 
0084   0B40 00 00 00 00 
0084   0B44 00 00 00 00 
0084   0B48 00 00 00 00 
0084   0B4C 00 00 00 00 
0084   0B50 00 00 00 00 
0084   0B54 00 00 00 00 
0084   0B58 00 00 00 00 
0084   0B5C 00 00 00 00 
0084   0B60 00 00 00 00 
0084   0B64 00 00 00 00 
0084   0B68 00 00 00 00 
0084   0B6C 00 00 00 00 
0084   0B70 00 00 00 00 
0084   0B74 00 00 00 00 
0084   0B78 00 00 00 00 
0084   0B7C 00 00 00 00 
0084   0B80 00 00 00 00 
0084   0B84 00 00 00 00 
0084   0B88 00 00 00 00 
0084   0B8C 00 00 00 00 
0084   0B90 00 00 00 00 
0084   0B94 00 00 00 00 
0084   0B98 00 00 00 00 
0084   0B9C 00 00 00 00 
0084   0BA0 00 00 00 00 
0084   0BA4 00 00 00 00 
0084   0BA8 00 00 00 00 
0084   0BAC 00 00 00 00 
0084   0BB0 00 00 00 00 
0084   0BB4 00 00 00 00 
0084   0BB8 00 00 00 00 
0084   0BBC 00 00 00 00 
0084   0BC0 00 00 00 00 
0084   0BC4 00 00 00 00 
0084   0BC8 00 00 00 00 
0084   0BCC 00 00 00 00 
0084   0BD0 00 00 00 00 
0084   0BD4 00 00 00 00 
0084   0BD8 00 00 00 00 
0084   0BDC 00 00 00 00 
0084   0BE0 00 00 00 00 
0084   0BE4 00 00 00 00 
0084   0BE8 00 00 00 00 
0084   0BEC 00 00 00 00 
0084   0BF0 00 00 00 00 
0084   0BF4 00 00 00 00 
0084   0BF8 00 00 00 00 
0084   0BFC 00 00 00 00 
0084   0C00 00 00 00 00 
0084   0C04 00 00 00 00 
0084   0C08 00 00 00 00 
0084   0C0C 00 00 00 00 
0084   0C10 00 00 00 00 
0084   0C14 00 00 00 00 
0084   0C18 00 00 00 00 
0084   0C1C 00 00 00 00 
0084   0C20 00 00 00 00 
0084   0C24 00 00 00 00 
0084   0C28 00 00 00 00 
0084   0C2C 00 00 00 00 
0084   0C30 00 00 00 00 
0084   0C34 00 00 00 00 
0084   0C38 00 00 00 00 
0084   0C3C 00 00 00 00 
0084   0C40 00 00 00 00 
0084   0C44 00 00 00 00 
0084   0C48 00 00 00 00 
0084   0C4C 00 00 00 00 
0084   0C50 00 00 00 00 
0084   0C54 00 00 00 00 
0084   0C58 00 00 00 00 
0084   0C5C 00 00 00 00 
0084   0C60 00 00 00 00 
0084   0C64 00 00 00 00 
0084   0C68 00 00 00 00 
0084   0C6C 00 00 00 00 
0084   0C70 00 00 00 00 
0084   0C74 00 00 00 00 
0084   0C78 00 00 00 00 
0084   0C7C 00 00 00 00 
0084   0C80 00 00 00 00 
0084   0C84 00 00 00 00 
0084   0C88 00 00 00 00 
0084   0C8C 00 00 00 00 
0084   0C90 00 00 00 00 
0084   0C94 00 00 00 00 
0084   0C98 00 00 00 00 
0084   0C9C 00 00 00 00 
0084   0CA0 00 00 00 00 
0084   0CA4 00 00 00 00 
0084   0CA8 00 00 00 00 
0084   0CAC 00 00 00 00 
0084   0CB0 00 00 00 00 
0084   0CB4 00 00 00 00 
0084   0CB8 00 00 00 00 
0084   0CBC 00 00 00 00 
0084   0CC0 00 00 00 00 
0084   0CC4 00 00 00 00 
0084   0CC8 00 00 00 00 
0084   0CCC 00 00 00 00 
0084   0CD0 00 00 00 00 
0084   0CD4 00 00 00 00 
0084   0CD8 00 00 00 00 
0084   0CDC 00 00 00 00 
0084   0CE0 00 00 00 00 
0084   0CE4 00 00 00 00 
0084   0CE8 00 00 00 00 
0084   0CEC 00 00 00 00 
0084   0CF0 00 00 00 00 
0084   0CF4 00 00 00 00 
0084   0CF8 00 00 00 00 
0084   0CFC 00 00 00 00 
0084   0D00 00 00 00 00 
0084   0D04 00 00 00 00 
0084   0D08 00 00 00 00 
0084   0D0C 00 00 00 00 
0084   0D10 00 00 00 00 
0084   0D14 00 00 00 00 
0084   0D18 00 00 00 00 
0084   0D1C 00 00 00 00 
0084   0D20 00 00 00 00 
0084   0D24 00 00 00 00 
0084   0D28 00 00 00 00 
0084   0D2C 00 00 00 00 
0084   0D30 00 00 00 00 
0084   0D34 00 00 00 00 
0084   0D38 00 00 00 00 
0084   0D3C 00 00 00 00 
0084   0D40 00 00 00 00 
0084   0D44 00 00 00 00 
0084   0D48 00 00 00 00 
0084   0D4C 00 00 00 00 
0084   0D50 00 00 00 00 
0084   0D54 00 00 00 00 
0084   0D58 00 00 00 00 
0084   0D5C 00 00 00 00 
0084   0D60 00 00 00 00 
0084   0D64 00 00 00 00 
0084   0D68 00 00 00 00 
0084   0D6C 00 00 00 00 
0084   0D70 00 00 00 00 
0084   0D74 00 00 00 00 
0084   0D78 00 00 00 00 
0084   0D7C 00 00 00 00 
0084   0D80 00 00 00 00 
0084   0D84 00 00 00 00 
0084   0D88 00 00 00 00 
0084   0D8C 00 00 00 00 
0084   0D90 00 00 00 00 
0084   0D94 00 00 00 00 
0084   0D98 00 00 00 00 
0084   0D9C 00 00 00 00 
0084   0DA0 00 00 00 00 
0084   0DA4 00 00 00 00 
0084   0DA8 00 00 00 00 
0084   0DAC 00 00 00 00 
0084   0DB0 00 00 00 00 
0084   0DB4 00 00 00 00 
0084   0DB8 00 00 00 00 
0084   0DBC 00 00 00 00 
0084   0DC0 00 00 00 00 
0084   0DC4 00 00 00 00 
0084   0DC8 00 00 00 00 
0084   0DCC 00 00 00 00 
0084   0DD0 00 00 00 00 
0084   0DD4 00 00 00 00 
0084   0DD8 00 00 00 00 
0084   0DDC 00 00 00 00 
0084   0DE0 00 00 00 00 
0084   0DE4 00 00 00 00 
0084   0DE8 00 00 00 00 
0084   0DEC 00 00 00 00 
0084   0DF0 00 00 00 00 
0084   0DF4 00 00 00 00 
0084   0DF8 00 00 00 00 
0084   0DFC 00 00 00 00 
0084   0E00 00 00 00 00 
0084   0E04 00 00 00 00 
0084   0E08 00 00 00 00 
0084   0E0C 00 00 00 00 
0084   0E10 00 00 00 00 
0084   0E14 00 00 00 00 
0084   0E18 00 00 00 00 
0084   0E1C 00 00 00 00 
0084   0E20 00 00 00 00 
0084   0E24 00 00 00 00 
0084   0E28 00 00 00 00 
0084   0E2C 00 00 00 00 
0084   0E30 00 00 00 00 
0084   0E34 00 00 00 00 
0084   0E38 00 00 00 00 
0084   0E3C 00 00 00 00 
0084   0E40 00 00 00 00 
0084   0E44 00 00 00 00 
0084   0E48 00 00 00 00 
0084   0E4C 00 00 00 00 
0084   0E50 00 00 00 00 
0084   0E54 00 00 00 00 
0084   0E58 00 00 00 00 
0084   0E5C 00 00 00 00 
0084   0E60 00 00 00 00 
0084   0E64 00 00 00 00 
0084   0E68 00 00 00 00 
0084   0E6C 00 00 00 00 
0084   0E70 00 00 00 00 
0084   0E74 00 00 00 00 
0084   0E78 00 00 00 00 
0084   0E7C 00 00 00 00 
0084   0E80 00 00 00 00 
0084   0E84 00 00 00 00 
0084   0E88 00 00 00 00 
0084   0E8C 00 00 00 00 
0084   0E90 00 00 00 00 
0084   0E94 00 00 00 00 
0084   0E98 00 00 00 00 
0084   0E9C 00 00 00 00 
0084   0EA0 00 00 00 00 
0084   0EA4 00 00 00 00 
0084   0EA8 00 00 00 00 
0084   0EAC 00 00 00 00 
0084   0EB0 00 00 00 00 
0084   0EB4 00 00 00 00 
0084   0EB8 00 00 00 00 
0084   0EBC 00 00 00 00 
0084   0EC0 00 00 00 00 
0084   0EC4 00 00 00 00 
0084   0EC8 00 00 00 00 
0084   0ECC 00 00 00 00 
0084   0ED0 00 00 00 00 
0084   0ED4 00 00 00 00 
0084   0ED8 00 00 00 00 
0084   0EDC 00 00 00 00 
0084   0EE0 00 00 00 00 
0084   0EE4 00 00 00 00 
0084   0EE8 00 00 00 00 
0084   0EEC 00 00 00 00 
0084   0EF0 00 00 00 00 
0084   0EF4 00 00 00 00 
0084   0EF8 00 00 00 00 
0084   0EFC 00 00 00 00 
0084   0F00 00 00 00 00 
0084   0F04 00 00 00 00 
0084   0F08 00 00 00 00 
0084   0F0C 00 00 00 00 
0084   0F10 00 00 00 00 
0084   0F14 00 00 00 00 
0084   0F18 00 00 00 00 
0084   0F1C 00 00 00 00 
0084   0F20 00 00 00 00 
0084   0F24 00 00 00 00 
0084   0F28 00 00 00 00 
0084   0F2C 00 00 00 00 
0084   0F30 00 00 00 00 
0084   0F34 00 00 00 00 
0084   0F38 00 00 00 00 
0084   0F3C 00 00 00 00 
0084   0F40 00 00 00 00 
0084   0F44 00 00 00 00 
0084   0F48 00 00 00 00 
0084   0F4C 00 00 00 00 
0084   0F50 00 00 00 00 
0084   0F54 00 00 00 00 
0084   0F58 00 00 00 00 
0084   0F5C 00 00 00 00 
0084   0F60 00 00 00 00 
0084   0F64 00 00 00 00 
0084   0F68 00 00 00 00 
0084   0F6C 00 00 00 00 
0084   0F70 00 00 00 00 
0084   0F74 00 00 00 00 
0084   0F78 00 00 00 00 
0084   0F7C 00 00 00 00 
0084   0F80 00 00 00 00 
0084   0F84 00 00 00 00 
0084   0F88 00 00 00 00 
0084   0F8C 00 00 00 00 
0084   0F90 00 00 00 00 
0084   0F94 00 00 00 00 
0084   0F98 00 00 00 00 
0084   0F9C 00 00 00 00 
0084   0FA0 00 00 00 00 
0084   0FA4 00 00 00 00 
0084   0FA8 00 00 00 00 
0084   0FAC 00 00 00 00 
0084   0FB0 00 00 00 00 
0084   0FB4 00 00 00 00 
0084   0FB8 00 00 00 00 
0084   0FBC 00 00 00 00 
0084   0FC0 00 00 00 00 
0084   0FC4 00 00 00 00 
0084   0FC8 00 00 00 00 
0084   0FCC 00 00 00 00 
0084   0FD0 00 00 00 00 
0084   0FD4 00 00 00 00 
0084   0FD8 00 00 00 00 
0084   0FDC 00 00 00 00 
0084   0FE0 00 00 00 00 
0084   0FE4 00 00 00 00 
0084   0FE8 00 00 00 00 
0084   0FEC 00 00 00 00 
0084   0FF0 00 00 00 00 
0084   0FF4 00 00 00 00 
0084   0FF8 00 00 00 00 
0084   0FFC 00 00 00 00 
0085   1000             
0086   1000                     .ORG    $1000
0087   1000             
0088   1000                     ; Initialize port, stack
0089   1000             START:
0090   1000             ;        MOVP    %$FF,BPORT  ; PORTB = FF, PORTB=All ones (MC high, make sure external ROM enabled)
0091   1000 52 0C               MOV     %$0C,B      ; B  = 0C
0092   1002 0D                  LDSP                ; SP = 000C - we don't use stack anyway
0093   1003 A2 AA 00            MOVP    %$AA,IOCNT0 ; Disable some interrupts, set for Full Expansion mode after mode switch
0094   1006             
0095   1006                     ; Try to identify this chip and store a code in R3
0096   1006             
0097   1006             RAMCHK:
0098   1006                     ; Identify RAM size:
0099   1006                     ; do checks twice with different data,
0100   1006                     ; to protect against random luck matches
0101   1006             
0102   1006 72 55 FF            MOV     %$55,$ff
0103   1009 72 AA 7F            MOV     %$AA,$7f
0104   100C 7D 55 FF            CMP     %$55,$ff    ; check for 256 bytes working
0105   100F E6 10               JNZ     RAM128
0106   1011 72 AA FF            MOV     %$AA,$ff
0107   1014 72 55 7F            MOV     %$55,$7f
0108   1017 7D AA FF            CMP     %$AA,$ff    ; doublecheck for 256 bytes working
0109   101A E6 05               JNZ     RAM128
0110   101C             
0111   101C             RAM256:
0112   101C 72 02 03            MOV     %$02,R3     ; 256 bytes
0113   101F E0 03               JMP     SERCHK
0114   1021             RAM128:
0115   1021 72 00 03            MOV     %$00,R3     ; 128 bytes
0116   1024             ;        JMP     SERCHK
0117   1024             
0118   1024                     ; Try to store bottom two bits of SCTL1 register and see if they stay
0119   1024                     ; if so, we have a UART
0120   1024                     ; We try both the locations, once for the 70X2 chip, and then the 70CX2 chip
0121   1024             
0122   1024             SERCHK:
0123   1024 A3 FC 15            ANDP    %$FC,SCTL1  ; zero the 2 LS bits
0124   1027 80 15               MOVP    SCTL1,A
0125   1029 23 03               AND     %$03,A
0126   102B E6 16               JNZ     SERCHKC     ; fail if not zero
0127   102D A4 01 15            ORP     %$01,SCTL1  ; set the bottom bit
0128   1030 80 15               MOVP    SCTL1,A
0129   1032 23 03               AND     %$03,A 
0130   1034 2D 01               CMP     %$01,A      ; check if it's a one now
0131   1036 E6 0B               JNZ     SERCHKC     ; or fail
0132   1038 A4 02 15            ORP     %$02,SCTL1  ; set the next bit
0133   103B 80 15               MOVP    SCTL1,A
0134   103D 23 03               AND     %$03,A 
0135   103F 2D 03               CMP     %$03,A      ; should be 3 now
0136   1041 E2 1F               JZ      SERFOUND    ; if not fail
0137   1043             
0138   1043             SERCHKC:
0139   1043 A3 FC 18            ANDP    %$FC,SCTL1C  ; zero the 2 LS bits
0140   1046 80 18               MOVP    SCTL1C,A
0141   1048 23 03               AND     %$03,A
0142   104A E6 19               JNZ     SERFAIL     ; fail if not zero
0143   104C A4 01 18            ORP     %$01,SCTL1C  ; set the bottom bit
0144   104F 80 18               MOVP    SCTL1C,A
0145   1051 23 03               AND     %$03,A 
0146   1053 2D 01               CMP     %$01,A      ; check if it's a one now
0147   1055 E6 0E               JNZ     SERFAIL     ; or fail
0148   1057 A4 02 18            ORP     %$02,SCTL1C  ; set the next bit
0149   105A 80 18               MOVP    SCTL1C,A
0150   105C 23 03               AND     %$03,A 
0151   105E 2D 03               CMP     %$03,A      ; should be 3 now
0152   1060 E6 03               JNZ     SERFAIL     ; if not fail
0153   1062             SERFOUND:
0154   1062 74 01 03            OR      %$01,R3     ; UART detected, set this bit
0155   1065             SERFAIL:
0156   1065             
0157   1065                     ; Copy code from External ROM to RAM
0158   1065 72 10 02            MOV     %$10,R2     ; More than enough for the size of our code
0159   1068             COPYCODE:
0160   1068 88 10 85 05         MOVD    %RAMCODE,R5 ; Start of ROM source
0161   106C 88 00 08 07         MOVD    %RAMDEST,R7 ; Start of RAM destination
0162   1070             CPYLOOP:
0163   1070 9A 05               LDA     *R5         ; grab code byte
0164   1072 9B 07               STA     *R7         ; move code byte
0165   1074 D3 07               INC     R7          ; increment destination
0166   1076 79 00 06            ADC     %$0,R6      ; ripple carry to high byte
0167   1079 D3 05               INC     R5          ; increment source
0168   107B 79 00 04            ADC     %$0,R4      ; ripple carry to high byte
0169   107E D2 02               DEC     R2          ; done yet?
0170   1080 E6 EE               JNZ     CPYLOOP     ; if we are not done, loop to copy next byte
0171   1082                     ; our code copy to RAM is done
0172   1082 8C 00 08            BR      @RAMDEST    ; jump to code in RAM
0173   1085             
0174   1085             ; Start of code to be executed in RAM
0175   1085             ; (Must be relocatable)
0176   1085             
0177   1085             RAMCODE:
0178   1085 22 55               MOV     %$55,A      ; Byte signifying request to switch modes
0179   1087 8B 10 00            STA     @ARDADDR    ; switch modes
0180   108A 52 FF               MOV     %$FF,B      ; B = FF
0181   108C             DELAY:
0182   108C C2                  DEC     B           ; B = B-1
0183   108D E6 FD               JNZ     DELAY       ; wait a bit for things to settle
0184   108F 8C 10 92            BR      @BACK2ROM
0185   1092             
0186   1092             ;   determine internal ROM size
0187   1092             
0188   1092             BACK2ROM:
0189   1092 72 08 02            MOV     %$08,R2     ; Number of 2K pages
0190   1095 88 C0 00 05         MOVD    %$C000,R5   ; Start of 16K ROM
0191   1099 9A 05       X1:     LDA     *R5
0192   109B 32 04               MOV     R4,B        ; expected byte might have a bit 3 set, but we need to reset it
0193   109D 53 F7               AND     %$F7,B      ; before comparing to the byte read from ROM
0194   109F 6D                  CMP     B,A         ; expected byte in B if reading external memory
0195   10A0 E6 11               JNZ     FINISHUP
0196   10A2 D3 05               INC     R5
0197   10A4 7D 20 05            CMP     %$20,R5     ; done checking 32 bytes?
0198   10A7 E6 F0               JNZ     X1
0199   10A9 72 00 05            MOV     %$0,R5      ; if so, start next 2K region, + 0x0800
0200   10AC D2 02               DEC     R2          ; but first, subtract 1 from num of 2K regions
0201   10AE 78 08 04            ADD     %$8,R4
0202   10B1 E6 E6               JNZ     X1          ; done with all regions?
0203   10B3             
0204   10B3             FINISHUP:
0205   10B3                     ; Update R3 with # of 2K pages from R2
0206   10B3 B0                  CLRC
0207   10B4 DE 02               RL      R2
0208   10B6 DE 02               RL      R2
0209   10B8 48 02 03            ADD     R2,R3       ; add to ID byte in the right place
0210   10BB             
0211   10BB                     ; at this point:
0212   10BB                     ;   R3 is the complete ID byte
0213   10BB                     ;   R4 is the high byte of the start of internal rom to dump 
0214   10BB                     ;     (or 00)
0215   10BB 72 00 05            MOV     %$00,R5     ; now R4:R5 is the start of internal ROM (or 0000)
0216   10BE             
0217   10BE             DODUMP:
0218   10BE 12 03               MOV     R3,A
0219   10C0 8B 10 00            STA     @ARDADDR    ; send ID byte to the arduino
0220   10C3             
0221   10C3 7D 00 04            CMP     %$00,R4     ; check if no internal rom
0222   10C6 E2 0C               JZ      DONE
0223   10C8             
0224   10C8             NXTBYTE:
0225   10C8 9A 05               LDA     *R5         ; Read internal ROM byte
0226   10CA 8B 10 00            STA     @ARDADDR    ; send a byte to the arduino
0227   10CD             
0228   10CD D3 05               INC     R5          ; increment for next location to read
0229   10CF 79 00 04            ADC     %$0,R4
0230   10D2 E6 F4               JNZ     NXTBYTE     ; unless we roll over to 0000, do next byte
0231   10D4             
0232   10D4             DONE:
0233   10D4 E0 FE               JMP     DONE        ; loop forever
0234   10D6             
0235   C000                     .ORG    $C000       ; External Memory in the last 16K
0236   C000 C0 C0 C0 C0         .FILL   $20,$C0     ; If this data is read in Full Expansion mode, then this is not a 16K internal ROM chip
0236   C004 C0 C0 C0 C0 
0236   C008 C0 C0 C0 C0 
0236   C00C C0 C0 C0 C0 
0236   C010 C0 C0 C0 C0 
0236   C014 C0 C0 C0 C0 
0236   C018 C0 C0 C0 C0 
0236   C01C C0 C0 C0 C0 
0237   C020             
0238   D000                     .ORG    $D000       ; External Memory in the last 12K
0239   D000 D0 D0 D0 D0         .FILL   $20,$D0     ; If this data is read in Full Expansion mode, then this is not a >6K internal ROM chip
0239   D004 D0 D0 D0 D0 
0239   D008 D0 D0 D0 D0 
0239   D00C D0 D0 D0 D0 
0239   D010 D0 D0 D0 D0 
0239   D014 D0 D0 D0 D0 
0239   D018 D0 D0 D0 D0 
0239   D01C D0 D0 D0 D0 
0240   D020             
0241   E000                     .ORG    $E000       ; External Memory in the last 8K
0242   E000 E0 E0 E0 E0         .FILL   $20,$E0     ; If this data is read in Full Expansion mode, then this is not a >6K internal ROM chip
0242   E004 E0 E0 E0 E0 
0242   E008 E0 E0 E0 E0 
0242   E00C E0 E0 E0 E0 
0242   E010 E0 E0 E0 E0 
0242   E014 E0 E0 E0 E0 
0242   E018 E0 E0 E0 E0 
0242   E01C E0 E0 E0 E0 
0243   E020             
0244   FF00                     .ORG    $FF00       ; External Memory in the last 4K
0245   FF00 F0 F0 F0 F0         .FILL   $20,$F0     ; If this data is read in Full Expansion mode, then this is not a 4K internal ROM chip
0245   FF04 F0 F0 F0 F0 
0245   FF08 F0 F0 F0 F0 
0245   FF0C F0 F0 F0 F0 
0245   FF10 F0 F0 F0 F0 
0245   FF14 F0 F0 F0 F0 
0245   FF18 F0 F0 F0 F0 
0245   FF1C F0 F0 F0 F0 
0246   FF20             
0247   FF20                     ; Vectors go here
0248   FF20             
0249   FFF8                     .ORG    $FFF8
0250   FFF8             
0251   FFF8                     .MSFIRST            ; need this, or .word statements are backwards for this CPU
0252   FFF8             
0253   FFF8 10 00               .word   START
0254   FFFA 10 00               .word   START
0255   FFFC 10 00               .word   START
0256   FFFE 10 00               .word   START
0257   10000             
0258   10000                     .end
0259   10000             
0260   10000             
tasm: Number of errors = 0
